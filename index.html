<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Konekt â€¢ Advanced Community Forum</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    :root {
      --apple-blue: #007AFF;
      --apple-green: #34C759;
      --apple-orange: #FF9500;
      --apple-red: #FF3B30;
      --apple-purple: #AF52DE;
      --apple-indigo: #5856D6;
      --apple-gray-1: #F5F5F7;
      --apple-gray-2: #E8E8ED;
      --apple-gray-3: #C6C6C8;
      --apple-gray-6: #8E8E93;
      --apple-gray-9: #1D1D1F;
      --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--apple-gray-1);
      color: var(--apple-gray-9);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    .app-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header Styles */
    .app-header {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 12px 0;
    }

    .app-header .navbar-brand {
      font-weight: 700;
      font-size: 24px;
      color: var(--apple-gray-9);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-header .navbar-brand i {
      color: var(--apple-blue);
    }

    .search-container {
      max-width: 400px;
      margin: 0 auto;
    }

    .search-box {
      background: var(--apple-gray-2);
      border: none;
      border-radius: 10px;
      padding: 10px 16px;
      width: 100%;
      font-size: 16px;
      transition: var(--transition);
    }

    .search-box:focus {
      background: white;
      box-shadow: 0 0 0 2px var(--apple-blue);
      outline: none;
    }

    .nav-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--apple-blue);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
    }

    /* Main Content */
    .main-content {
      display: grid;
      grid-template-columns: 280px 1fr 280px;
      gap: 24px;
      padding: 24px 0;
      min-height: calc(100vh - 80px);
    }

    /* Sidebar */
    .sidebar {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-section {
      margin-bottom: 32px;
    }

    .sidebar-section:last-child {
      margin-bottom: 0;
    }

    .sidebar-section h3 {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--apple-gray-9);
    }

    .category-list {
      list-style: none;
      padding: 0;
    }

    .category-list li {
      margin-bottom: 8px;
    }

    .category-list a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 10px;
      color: var(--apple-gray-9);
      text-decoration: none;
      transition: var(--transition);
      cursor: pointer;
    }

    .category-list a:hover, .category-list a.active {
      background: var(--apple-gray-2);
      color: var(--apple-blue);
    }

    .category-list i {
      font-size: 18px;
      width: 20px;
      text-align: center;
    }

    .category-count {
      background: var(--apple-gray-2);
      color: var(--apple-gray-6);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: auto;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .stat-card {
      background: var(--apple-gray-1);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: var(--transition);
      cursor: pointer;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      background: var(--apple-gray-2);
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--apple-blue);
    }

    .stat-label {
      font-size: 13px;
      color: var(--apple-gray-6);
      margin-top: 4px;
    }

    /* Right Sidebar */
    .trending-topics {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .topic-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--apple-gray-2);
    }

    .topic-item:last-child {
      border-bottom: none;
    }

    .topic-avatar {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: var(--apple-blue);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
    }

    .topic-content {
      flex: 1;
    }

    .topic-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 2px;
    }

    .topic-meta {
      font-size: 12px;
      color: var(--apple-gray-6);
    }

    /* Feed */
    .feed-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .welcome-card {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: var(--card-shadow);
      text-align: center;
    }

    .welcome-card h2 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .welcome-card p {
      color: var(--apple-gray-6);
      font-size: 17px;
      margin-bottom: 24px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .btn-apple {
      background: var(--apple-blue);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 600;
      font-size: 16px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-apple:hover {
      background: #0066D6;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 122, 255, 0.3);
    }

    .btn-apple-outline {
      background: transparent;
      color: var(--apple-blue);
      border: 2px solid var(--apple-blue);
      border-radius: 12px;
      padding: 10px 22px;
      font-weight: 600;
      font-size: 16px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-apple-outline:hover {
      background: rgba(0, 122, 255, 0.1);
      transform: translateY(-2px);
    }

    /* Filter Bar */
    .filter-bar {
      background: white;
      border-radius: 16px;
      padding: 16px 24px;
      box-shadow: var(--card-shadow);
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .filter-select {
      border: 2px solid var(--apple-gray-2);
      border-radius: 10px;
      padding: 8px 16px;
      background: white;
      font-size: 14px;
      cursor: pointer;
    }

    .filter-select:focus {
      border-color: var(--apple-blue);
      outline: none;
    }

    /* Posts */
    .posts-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .post-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      position: relative;
    }

    .post-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .post-card.pinned {
      border-left: 4px solid var(--apple-orange);
    }

    .pin-badge {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--apple-orange);
      color: white;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .post-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 18px;
    }

    .post-user {
      flex: 1;
    }

    .post-username {
      font-weight: 600;
      font-size: 17px;
      margin-bottom: 2px;
    }

    .post-meta {
      display: flex;
      gap: 12px;
      color: var(--apple-gray-6);
      font-size: 14px;
    }

    .post-category {
      background: var(--apple-gray-2);
      color: var(--apple-blue);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .post-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--apple-gray-9);
    }

    .post-content {
      font-size: 17px;
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .post-tags {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .post-tag {
      background: var(--apple-gray-1);
      color: var(--apple-gray-6);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
    }

    .post-actions {
      display: flex;
      gap: 20px;
      border-top: 1px solid var(--apple-gray-2);
      padding-top: 16px;
    }

    .post-action {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--apple-gray-6);
      font-size: 14px;
      transition: var(--transition);
      cursor: pointer;
      user-select: none;
    }

    .post-action:hover {
      color: var(--apple-blue);
    }

    .post-action.liked {
      color: var(--apple-red);
    }

    .post-action.active {
      color: var(--apple-blue);
    }

    /* Comments Section */
    .comments-section {
      margin-top: 20px;
      border-top: 1px solid var(--apple-gray-2);
      padding-top: 16px;
    }

    .comment-form {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .comment-input {
      flex: 1;
      border: 2px solid var(--apple-gray-2);
      border-radius: 12px;
      padding: 12px 16px;
      font-size: 14px;
      resize: vertical;
      min-height: 60px;
    }

    .comment-input:focus {
      border-color: var(--apple-blue);
      outline: none;
    }

    .comment-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .comment-card {
      background: var(--apple-gray-1);
      border-radius: 12px;
      padding: 16px;
    }

    .comment-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .comment-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    .comment-username {
      font-weight: 600;
      font-size: 14px;
    }

    .comment-meta {
      font-size: 12px;
      color: var(--apple-gray-6);
    }

    .comment-content {
      font-size: 14px;
      line-height: 1.5;
    }

    /* Analytics Dashboard */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .analytics-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      text-align: center;
    }

    .analytics-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--apple-blue);
      margin-bottom: 8px;
    }

    .analytics-label {
      font-size: 14px;
      color: var(--apple-gray-6);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .category-chart {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      margin-bottom: 24px;
    }

    .chart-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .chart-label {
      width: 100px;
      font-size: 14px;
      font-weight: 600;
    }

    .chart-progress {
      flex: 1;
      height: 20px;
      background: var(--apple-gray-2);
      border-radius: 10px;
      overflow: hidden;
    }

    .chart-fill {
      height: 100%;
      background: var(--apple-blue);
      border-radius: 10px;
      transition: width 0.5s ease;
    }

    .chart-count {
      width: 40px;
      text-align: right;
      font-size: 14px;
      color: var(--apple-gray-6);
    }

    /* Profile Section */
    .profile-header {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: var(--card-shadow);
      text-align: center;
      margin-bottom: 24px;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 32px;
      margin: 0 auto 16px;
    }

    .profile-name {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .profile-bio {
      color: var(--apple-gray-6);
      font-size: 16px;
      margin-bottom: 16px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .profile-stats {
      display: flex;
      gap: 32px;
      justify-content: center;
    }

    .profile-stat {
      text-align: center;
    }

    .profile-stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--apple-blue);
    }

    .profile-stat-label {
      font-size: 14px;
      color: var(--apple-gray-6);
    }

    /* Search Results */
    .search-results {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
    }

    .search-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--apple-gray-2);
    }

    .search-tab {
      padding: 8px 16px;
      background: none;
      border: none;
      color: var(--apple-gray-6);
      font-weight: 600;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }

    .search-tab.active {
      color: var(--apple-blue);
      border-bottom-color: var(--apple-blue);
    }

    /* Modals */
    .modal-apple .modal-content {
      border-radius: 16px;
      border: none;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    }

    .modal-apple .modal-header {
      border-bottom: 1px solid var(--apple-gray-2);
      padding: 24px 24px 16px;
    }

    .modal-apple .modal-body {
      padding: 24px;
    }

    .modal-apple .modal-footer {
      border-top: 1px solid var(--apple-gray-2);
      padding: 16px 24px 24px;
    }

    .form-apple .form-control {
      border-radius: 12px;
      border: 2px solid var(--apple-gray-2);
      padding: 14px 16px;
      font-size: 16px;
      transition: var(--transition);
    }

    .form-apple .form-control:focus {
      border-color: var(--apple-blue);
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
    }

    .form-apple .form-label {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--apple-gray-9);
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 100px;
      right: 20px;
      z-index: 1100;
    }

    .toast-apple {
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      border: none;
      overflow: hidden;
    }

    .toast-apple .toast-header {
      border-bottom: none;
      padding: 12px 16px 0;
      background: transparent;
    }

    .toast-apple .toast-body {
      padding: 0 16px 12px;
    }

    /* Auth Section */
    #auth-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      text-align: center;
    }

    /* Loading States */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .skeleton {
      background: linear-gradient(90deg, var(--apple-gray-2) 25%, var(--apple-gray-1) 50%, var(--apple-gray-2) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 8px;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .main-content {
        grid-template-columns: 1fr;
      }
      
      .sidebar, .trending-topics {
        position: static;
      }
    }

    @media (max-width: 768px) {
      .app-container {
        padding: 0 16px;
      }
      
      .main-content {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .filter-bar {
        flex-direction: column;
        gap: 12px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .post-card {
        padding: 20px 16px;
      }
      
      .profile-stats {
        flex-direction: column;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <div class="app-container">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="#">
          <i class="bi bi-chat-dots"></i>
          Konekt
        </a>
        
        <div class="search-container d-none" id="search-container">
          <input type="text" class="search-box" id="search-input" placeholder="Search posts, users, topics...">
        </div>
        
        <div class="ms-auto nav-user" id="user-section">
          <div class="d-none" id="logged-in-user">
            <button class="btn btn-sm btn-outline-secondary me-2" onclick="showAnalytics()">
              <i class="bi bi-graph-up"></i> Analytics
            </button>
            <button class="btn btn-sm btn-outline-secondary me-2" onclick="showProfile()">
              <i class="bi bi-person"></i> Profile
            </button>
            <span id="username-display" class="me-2"></span>
            <div class="user-avatar" id="user-avatar" onclick="showProfile()">U</div>
            <button class="btn btn-sm btn-outline-secondary" id="logout-btn">Log Out</button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="app-container">
    <div class="main-content">
      <!-- Left Sidebar -->
      <aside class="sidebar d-none" id="sidebar">
        <div class="sidebar-section">
          <h3>Categories</h3>
          <ul class="category-list" id="category-list">
            <!-- Categories will be populated dynamically -->
          </ul>
        </div>
        
        <div class="sidebar-section">
          <h3>Forum Stats</h3>
          <div class="stats-grid">
            <div class="stat-card" onclick="showAnalytics()">
              <div class="stat-value" id="stat-posts">0</div>
              <div class="stat-label">Posts</div>
            </div>
            <div class="stat-card" onclick="showAnalytics()">
              <div class="stat-value" id="stat-users">0</div>
              <div class="stat-label">Users</div>
            </div>
          </div>
        </div>
        
        <div class="sidebar-section">
          <h3>Online Now</h3>
          <div class="d-flex align-items-center gap-2 flex-wrap">
            <div class="user-avatar" style="background-color: #34C759;">JD</div>
            <div class="user-avatar" style="background-color: #FF9500;">AS</div>
            <div class="user-avatar" style="background-color: #FF3B30;">MJ</div>
            <span class="text-muted">+<span id="online-count">12</span> more</span>
          </div>
        </div>
      </aside>

      <!-- Main Feed -->
      <section class="feed-container">
        <!-- Welcome Card -->
        <section id="auth-section">
          <div class="welcome-card">
            <h2>Welcome to Konekt</h2>
            <p>Join our advanced community forum with real-time features, analytics, and more.</p>
            <div class="action-buttons">
              <button class="btn-apple" data-bs-toggle="modal" data-bs-target="#loginModal">
                <i class="bi bi-box-arrow-in-right"></i> Sign In
              </button>
              <button class="btn-apple-outline" data-bs-toggle="modal" data-bs-target="#registerModal">
                <i class="bi bi-person-plus"></i> Create Account
              </button>
            </div>
          </div>
        </section>

        <!-- Filter Bar -->
        <section class="filter-bar d-none" id="filter-bar">
          <select class="filter-select" id="category-filter">
            <option value="">All Categories</option>
          </select>
          <select class="filter-select" id="sort-filter">
            <option value="newest">Newest First</option>
            <option value="popular">Most Popular</option>
            <option value="trending">Trending</option>
          </select>
          <button class="btn-apple-outline ms-auto" data-bs-toggle="modal" data-bs-target="#createPostModal">
            <i class="bi bi-plus-circle"></i> New Post
          </button>
        </section>

        <!-- Analytics Dashboard -->
        <section class="d-none" id="analytics-section">
          <div class="welcome-card">
            <h2>Forum Analytics</h2>
            <p>Real-time insights about community activity and engagement.</p>
          </div>
          
          <div class="analytics-grid">
            <div class="analytics-card">
              <div class="analytics-value" id="analytics-posts">0</div>
              <div class="analytics-label">Total Posts</div>
            </div>
            <div class="analytics-card">
              <div class="analytics-value" id="analytics-users">0</div>
              <div class="analytics-label">Total Users</div>
            </div>
            <div class="analytics-card">
              <div class="analytics-value" id="analytics-likes">0</div>
              <div class="analytics-label">Total Likes</div>
            </div>
            <div class="analytics-card">
              <div class="analytics-value" id="analytics-comments">0</div>
              <div class="analytics-label">Total Comments</div>
            </div>
          </div>
          
          <div class="category-chart">
            <h4 class="mb-4">Posts by Category</h4>
            <div id="category-chart-container">
              <!-- Chart will be populated dynamically -->
            </div>
          </div>
          
          <div class="welcome-card">
            <h4>Recent Activity</h4>
            <div id="recent-activity">
              <!-- Recent activity will be populated dynamically -->
            </div>
          </div>
        </section>

        <!-- Profile Section -->
        <section class="d-none" id="profile-section">
          <div class="profile-header">
            <div class="profile-avatar" id="profile-avatar">U</div>
            <h2 class="profile-name" id="profile-name">Username</h2>
            <p class="profile-bio" id="profile-bio">No bio yet</p>
            <div class="profile-stats">
              <div class="profile-stat">
                <div class="profile-stat-value" id="profile-posts">0</div>
                <div class="profile-stat-label">Posts</div>
              </div>
              <div class="profile-stat">
                <div class="profile-stat-value" id="profile-likes">0</div>
                <div class="profile-stat-label">Likes</div>
              </div>
              <div class="profile-stat">
                <div class="profile-stat-value" id="profile-member">0d</div>
                <div class="profile-stat-label">Member</div>
              </div>
            </div>
          </div>
          
          <h4 class="mb-3">My Posts</h4>
          <div id="user-posts-container">
            <!-- User posts will be populated here -->
          </div>
        </section>

        <!-- Search Results -->
        <section class="d-none" id="search-results-section">
          <div class="search-results">
            <div class="search-tabs">
              <button class="search-tab active" data-tab="posts">Posts</button>
              <button class="search-tab" data-tab="users">Users</button>
            </div>
            <div id="search-posts-results">
              <!-- Search results for posts -->
            </div>
            <div id="search-users-results" class="d-none">
              <!-- Search results for users -->
            </div>
          </div>
        </section>

        <!-- Create Post Card -->
        <section class="d-none" id="create-post-section">
          <div class="post-card">
            <div class="post-header">
              <div class="user-avatar" id="current-user-avatar">U</div>
              <div class="post-user">
                <div class="post-username" id="current-username">User</div>
                <div class="post-meta">Ready to share something with the community?</div>
              </div>
            </div>
            <div class="post-content">
              <button class="btn-apple w-100" data-bs-toggle="modal" data-bs-target="#createPostModal">
                <i class="bi bi-plus-circle"></i> Create New Post
              </button>
            </div>
          </div>
        </section>

        <!-- Posts Container -->
        <section class="posts-container d-none" id="posts-section">
          <div id="posts-container">
            <!-- Posts will be dynamically inserted here -->
          </div>
          
          <!-- Pagination -->
          <nav class="d-none" id="pagination-container">
            <ul class="pagination justify-content-center">
              <li class="page-item disabled" id="prev-page">
                <a class="page-link" href="#">Previous</a>
              </li>
              <li class="page-item active"><a class="page-link" href="#">1</a></li>
              <li class="page-item" id="next-page">
                <a class="page-link" href="#">Next</a>
              </li>
            </ul>
          </nav>
        </section>
      </section>

      <!-- Right Sidebar -->
      <aside class="trending-topics d-none" id="trending-topics">
        <div class="sidebar-section">
          <h3>Trending Topics</h3>
          <div id="trending-topics-list">
            <!-- Trending topics will be populated dynamically -->
          </div>
        </div>
        
        <div class="sidebar-section">
          <h3>Top Contributors</h3>
          <div id="top-contributors">
            <!-- Top contributors will be populated dynamically -->
          </div>
        </div>
      </aside>
    </div>
  </main>

  <!-- Modals (Login, Register, Create Post) -->
  <!-- ... (same modals as before but enhanced) ... -->

  <!-- Enhanced Create Post Modal -->
  <div class="modal fade modal-apple" id="createPostModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Post</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form class="form-apple" id="createPostForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="postCategory" class="form-label">Category</label>
                <select class="form-control" id="postCategory" required>
                  <option value="">Select a category</option>
                  <option value="General">General</option>
                  <option value="Engineering">Engineering</option>
                  <option value="Healthcare">Healthcare</option>
                  <option value="Research">Research</option>
                  <option value="Community">Community</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="postTags" class="form-label">Tags (comma separated)</label>
                <input type="text" class="form-control" id="postTags" placeholder="tech, programming, help">
              </div>
            </div>
            <div class="mb-3">
              <label for="postTitle" class="form-label">Title</label>
              <input type="text" class="form-control" id="postTitle" placeholder="Enter a descriptive title">
            </div>
            <div class="mb-3">
              <label for="postContent" class="form-label">Content</label>
              <textarea class="form-control" id="postContent" rows="6" required placeholder="What would you like to share?"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-apple-outline" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn-apple" id="createPostBtn">Publish Post</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container">
    <!-- ... (same toast containers as before) ... -->
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
// Enhanced Konekt Forum - Complete JavaScript Implementation
const API_BASE = "https://hosting-production-a352.up.railway.app/api";

// Application State
let currentUser = null;
let currentPage = 1;
let postsPerPage = 10;
let currentCategory = '';
let currentSort = 'newest';
let currentSearchQuery = '';
let allPosts = [];
let categories = [];
let analyticsData = null;

// DOM Elements
const elements = {
    // Auth & UI Sections
    authSection: document.getElementById('auth-section'),
    createPostSection: document.getElementById('create-post-section'),
    postsSection: document.getElementById('posts-section'),
    sidebar: document.getElementById('sidebar'),
    trendingTopics: document.getElementById('trending-topics'),
    filterBar: document.getElementById('filter-bar'),
    searchContainer: document.getElementById('search-container'),
    analyticsSection: document.getElementById('analytics-section'),
    profileSection: document.getElementById('profile-section'),
    searchResultsSection: document.getElementById('search-results-section'),
    
    // User Elements
    loggedInUser: document.getElementById('logged-in-user'),
    usernameDisplay: document.getElementById('username-display'),
    userAvatar: document.getElementById('user-avatar'),
    currentUsername: document.getElementById('current-username'),
    currentUserAvatar: document.getElementById('current-user-avatar'),
    
    // Content Containers
    postsContainer: document.getElementById('posts-container'),
    categoryList: document.getElementById('category-list'),
    trendingTopicsList: document.getElementById('trending-topics-list'),
    topContributors: document.getElementById('top-contributors'),
    paginationContainer: document.getElementById('pagination-container'),
    
    // Stats & Analytics
    statPosts: document.getElementById('stat-posts'),
    statUsers: document.getElementById('stat-users'),
    analyticsPosts: document.getElementById('analytics-posts'),
    analyticsUsers: document.getElementById('analytics-users'),
    analyticsLikes: document.getElementById('analytics-likes'),
    analyticsComments: document.getElementById('analytics-comments'),
    categoryChartContainer: document.getElementById('category-chart-container'),
    recentActivity: document.getElementById('recent-activity'),
    
    // Profile
    profileAvatar: document.getElementById('profile-avatar'),
    profileName: document.getElementById('profile-name'),
    profileBio: document.getElementById('profile-bio'),
    profilePosts: document.getElementById('profile-posts'),
    profileLikes: document.getElementById('profile-likes'),
    profileMember: document.getElementById('profile-member'),
    userPostsContainer: document.getElementById('user-posts-container'),
    
    // Search
    searchInput: document.getElementById('search-input'),
    searchPostsResults: document.getElementById('search-posts-results'),
    searchUsersResults: document.getElementById('search-users-results'),
    
    // Filters
    categoryFilter: document.getElementById('category-filter'),
    sortFilter: document.getElementById('sort-filter'),
    
    // Modals & Forms
    loginForm: document.getElementById('loginForm'),
    registerForm: document.getElementById('registerForm'),
    createPostForm: document.getElementById('createPostForm'),
    
    // Buttons
    loginBtn: document.getElementById('loginBtn'),
    registerBtn: document.getElementById('registerBtn'),
    createPostBtn: document.getElementById('createPostBtn'),
    logoutBtn: document.getElementById('logoutBtn')
};

// Initialize Application
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

async function initializeApp() {
    setupEventListeners();
    await checkAuthStatus();
    await loadCategories();
    setupSearch();
}

function setupEventListeners() {
    // Auth Buttons
    elements.loginBtn?.addEventListener('click', handleLogin);
    elements.registerBtn?.addEventListener('click', handleRegister);
    elements.createPostBtn?.addEventListener('click', handleCreatePost);
    elements.logoutBtn?.addEventListener('click', handleLogout);
    
    // Filters
    elements.categoryFilter?.addEventListener('change', handleCategoryFilter);
    elements.sortFilter?.addEventListener('change', handleSortFilter);
    
    // Search
    elements.searchInput?.addEventListener('input', debounce(handleSearch, 300));
    
    // Search Tabs
    document.querySelectorAll('.search-tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
            const tabType = e.target.getAttribute('data-tab');
            switchSearchTab(tabType);
        });
    });
    
    // Navigation
    document.addEventListener('click', handleGlobalClick);
}

// Authentication Functions
async function checkAuthStatus() {
    const token = localStorage.getItem('token');
    const userData = localStorage.getItem('userData');
    
    if (token && userData) {
        try {
            currentUser = JSON.parse(userData);
            showAuthenticatedUI();
            await loadInitialData();
        } catch (error) {
            console.error('Auth check failed:', error);
            handleLogout();
        }
    } else {
        showUnauthenticatedUI();
    }
}

function showAuthenticatedUI() {
    elements.authSection.classList.add('d-none');
    elements.createPostSection.classList.remove('d-none');
    elements.postsSection.classList.remove('d-none');
    elements.sidebar.classList.remove('d-none');
    elements.trendingTopics.classList.remove('d-none');
    elements.filterBar.classList.remove('d-none');
    elements.searchContainer.classList.remove('d-none');
    elements.loggedInUser.classList.remove('d-none');
    
    elements.usernameDisplay.textContent = currentUser.username;
    elements.currentUsername.textContent = currentUser.username;
    
    const initials = currentUser.username.charAt(0).toUpperCase();
    elements.userAvatar.textContent = initials;
    elements.currentUserAvatar.textContent = initials;
    elements.userAvatar.style.backgroundColor = currentUser.avatar_color || '#007AFF';
    elements.currentUserAvatar.style.backgroundColor = currentUser.avatar_color || '#007AFF';
}

function showUnauthenticatedUI() {
    elements.authSection.classList.remove('d-none');
    elements.createPostSection.classList.add('d-none');
    elements.postsSection.classList.add('d-none');
    elements.sidebar.classList.add('d-none');
    elements.trendingTopics.classList.add('d-none');
    elements.filterBar.classList.add('d-none');
    elements.searchContainer.classList.add('d-none');
    elements.analyticsSection.classList.add('d-none');
    elements.profileSection.classList.add('d-none');
    elements.searchResultsSection.classList.add('d-none');
    elements.loggedInUser.classList.add('d-none');
}

// API Functions
async function apiCall(endpoint, options = {}) {
    const token = localStorage.getItem('token');
    const config = {
        headers: {
            'Content-Type': 'application/json',
            ...(token && { 'Authorization': token }),
            ...options.headers
        },
        ...options
    };
    
    if (config.body && typeof config.body === 'object') {
        config.body = JSON.stringify(config.body);
    }
    
    try {
        const response = await fetch(`${API_BASE}${endpoint}`, config);
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.error || `HTTP ${response.status}`);
        }
        
        return data;
    } catch (error) {
        console.error('API call failed:', error);
        showToast(error.message, 'error');
        throw error;
    }
}

// Auth Handlers
async function handleLogin() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    
    if (!username || !password) {
        showToast('Please fill in all fields', 'error');
        return;
    }
    
    try {
        const data = await apiCall('/login', {
            method: 'POST',
            body: { username, password }
        });
        
        if (data.success && data.token) {
            localStorage.setItem('token', data.token);
            localStorage.setItem('userData', JSON.stringify(data.user));
            currentUser = data.user;
            
            // Close modal and reset form
            const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
            loginModal.hide();
            document.getElementById('loginForm').reset();
            
            showAuthenticatedUI();
            await loadInitialData();
            showToast('Successfully signed in!', 'success');
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

async function handleRegister() {
    const username = document.getElementById('registerUsername').value;
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerConfirmPassword').value;
    
    if (!username || !password || !confirmPassword) {
        showToast('Please fill in all fields', 'error');
        return;
    }
    
    if (password !== confirmPassword) {
        showToast('Passwords do not match', 'error');
        return;
    }
    
    try {
        const data = await apiCall('/register', {
            method: 'POST',
            body: { username, password }
        });
        
        if (data.success) {
            const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
            registerModal.hide();
            document.getElementById('registerForm').reset();
            showToast('Account created successfully! Please sign in.', 'success');
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

function handleLogout() {
    localStorage.removeItem('token');
    localStorage.removeItem('userData');
    currentUser = null;
    showUnauthenticatedUI();
    showToast('Successfully signed out', 'success');
}

// Post Management
async function handleCreatePost() {
    const category = document.getElementById('postCategory').value;
    const title = document.getElementById('postTitle').value;
    const content = document.getElementById('postContent').value;
    const tags = document.getElementById('postTags').value;
    
    if (!category || !content) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    try {
        const data = await apiCall('/posts', {
            method: 'POST',
            body: {
                category,
                title: title || null,
                content,
                tags: tags || null
            }
        });
        
        if (data.success) {
            const createPostModal = bootstrap.Modal.getInstance(document.getElementById('createPostModal'));
            createPostModal.hide();
            document.getElementById('createPostForm').reset();
            
            await loadPosts();
            showToast('Post published successfully!', 'success');
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

async function loadPosts(page = 1) {
    try {
        const params = new URLSearchParams({
            page: page.toString(),
            per_page: postsPerPage.toString(),
            ...(currentCategory && { category: currentCategory }),
            ...(currentSearchQuery && { search: currentSearchQuery })
        });
        
        const data = await apiCall(`/posts?${params}`);
        
        if (data.success) {
            allPosts = data.data;
            displayPosts(allPosts);
            updatePagination(data.pagination);
            updateStats(data.pagination);
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

function displayPosts(posts) {
    if (!posts || posts.length === 0) {
        elements.postsContainer.innerHTML = `
            <div class="post-card text-center py-5">
                <i class="bi bi-inbox display-1 text-muted mb-3"></i>
                <h3 class="text-muted">No posts found</h3>
                <p class="text-muted">${currentSearchQuery ? 'Try a different search term' : 'Be the first to share something with the community!'}</p>
            </div>
        `;
        return;
    }
    
    elements.postsContainer.innerHTML = '';
    
    posts.forEach(post => {
        const postElement = createPostElement(post);
        elements.postsContainer.appendChild(postElement);
    });
}

function createPostElement(post) {
    const postElement = document.createElement('div');
    postElement.className = `post-card ${post.is_pinned ? 'pinned' : ''}`;
    
    const initials = post.username ? post.username.charAt(0).toUpperCase() : 'U';
    const avatarColor = post.avatar_color || '#007AFF';
    const formattedDate = formatDate(post.timestamp);
    
    postElement.innerHTML = `
        ${post.is_pinned ? '<div class="pin-badge"><i class="bi bi-pin"></i> Pinned</div>' : ''}
        <div class="post-header">
            <div class="post-avatar" style="background-color: ${avatarColor}">${initials}</div>
            <div class="post-user">
                <div class="post-username">${post.username || 'Unknown User'}</div>
                <div class="post-meta">
                    <span>${formattedDate}</span>
                </div>
            </div>
            <div class="post-category">${post.category || 'General'}</div>
        </div>
        ${post.title ? `<div class="post-title">${post.title}</div>` : ''}
        <div class="post-content">
            ${post.content || ''}
        </div>
        ${post.tags ? `
        <div class="post-tags">
            ${post.tags.split(',').map(tag => 
                `<span class="post-tag">#${tag.trim()}</span>`
            ).join('')}
        </div>
        ` : ''}
        <div class="post-actions">
            <div class="post-action like-action" data-post-id="${post.id}">
                <i class="bi bi-heart${post.user_has_liked ? '-fill' : ''}"></i>
                <span class="like-count">${post.likes_count || 0}</span>
            </div>
            <div class="post-action comment-action" data-post-id="${post.id}">
                <i class="bi bi-chat"></i>
                <span>${post.comments_count || 0}</span>
            </div>
            <div class="post-action">
                <i class="bi bi-share"></i>
                <span>Share</span>
            </div>
        </div>
        <div class="comments-section d-none" id="comments-${post.id}">
            <div class="comment-form">
                <textarea class="comment-input" placeholder="Write a comment..." id="comment-input-${post.id}"></textarea>
                <button class="btn-apple" onclick="addComment(${post.id})">Post</button>
            </div>
            <div class="comment-list" id="comment-list-${post.id}">
                <!-- Comments will be loaded here -->
            </div>
        </div>
    `;
    
    // Add event listeners
    const likeAction = postElement.querySelector('.like-action');
    const commentAction = postElement.querySelector('.comment-action');
    
    likeAction.addEventListener('click', () => handleLikePost(post.id));
    commentAction.addEventListener('click', () => toggleComments(post.id));
    
    return postElement;
}

// Like System
async function handleLikePost(postId) {
    try {
        const data = await apiCall(`/posts/${postId}/like`, {
            method: 'POST'
        });
        
        if (data.success) {
            // Update UI
            const likeAction = document.querySelector(`.like-action[data-post-id="${postId}"]`);
            const likeIcon = likeAction.querySelector('i');
            const likeCount = likeAction.querySelector('.like-count');
            
            likeIcon.className = data.action === 'liked' ? 'bi bi-heart-fill' : 'bi bi-heart';
            likeAction.classList.toggle('liked', data.action === 'liked');
            likeCount.textContent = data.likes_count;
            
            showToast(`Post ${data.action}`, 'success');
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

// Comment System
async function toggleComments(postId) {
    const commentsSection = document.getElementById(`comments-${postId}`);
    const commentList = document.getElementById(`comment-list-${postId}`);
    
    if (commentsSection.classList.contains('d-none')) {
        // Load comments
        try {
            const data = await apiCall(`/posts/${postId}/comments`);
            
            if (data.success) {
                displayComments(commentList, data.data);
                commentsSection.classList.remove('d-none');
            }
        } catch (error) {
            // Error handled in apiCall
        }
    } else {
        commentsSection.classList.add('d-none');
    }
}

function displayComments(container, comments) {
    if (!comments || comments.length === 0) {
        container.innerHTML = '<p class="text-muted text-center">No comments yet</p>';
        return;
    }
    
    container.innerHTML = comments.map(comment => `
        <div class="comment-card">
            <div class="comment-header">
                <div class="comment-avatar" style="background-color: ${comment.avatar_color || '#007AFF'}">
                    ${comment.username ? comment.username.charAt(0).toUpperCase() : 'U'}
                </div>
                <div>
                    <div class="comment-username">${comment.username}</div>
                    <div class="comment-meta">${formatDate(comment.timestamp)}</div>
                </div>
            </div>
            <div class="comment-content">${comment.content}</div>
        </div>
    `).join('');
}

async function addComment(postId) {
    const commentInput = document.getElementById(`comment-input-${postId}`);
    const content = commentInput.value.trim();
    
    if (!content) {
        showToast('Please write a comment', 'error');
        return;
    }
    
    try {
        const data = await apiCall(`/posts/${postId}/comments`, {
            method: 'POST',
            body: { content }
        });
        
        if (data.success) {
            commentInput.value = '';
            await toggleComments(postId); // Reload comments
            showToast('Comment added successfully!', 'success');
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

// Categories & Filtering
async function loadCategories() {
    try {
        const data = await apiCall('/analytics/overview');
        
        if (data.success) {
            categories = Object.keys(data.overview.categories || {});
            updateCategoryFilters();
            updateCategoryStats(data.overview.categories);
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

function updateCategoryFilters() {
    // Update sidebar categories
    elements.categoryList.innerHTML = `
        <li>
            <a href="#" class="active" data-category="">
                <i class="bi bi-house"></i> All Posts
                <span class="category-count">${allPosts.length}</span>
            </a>
        </li>
        ${categories.map(category => `
            <li>
                <a href="#" data-category="${category}">
                    <i class="bi bi-tag"></i> ${category}
                    <span class="category-count">0</span>
                </a>
            </li>
        `).join('')}
    `;
    
    // Update filter dropdown
    elements.categoryFilter.innerHTML = `
        <option value="">All Categories</option>
        ${categories.map(category => `
            <option value="${category}">${category}</option>
        `).join('')}
    `;
    
    // Add event listeners to category links
    elements.categoryList.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const category = e.target.getAttribute('data-category');
            handleCategorySelect(category);
        });
    });
}

function handleCategorySelect(category) {
    currentCategory = category;
    currentPage = 1;
    
    // Update active states
    elements.categoryList.querySelectorAll('a').forEach(link => {
        link.classList.remove('active');
    });
    event.target.classList.add('active');
    
    elements.categoryFilter.value = category;
    loadPosts();
}

function handleCategoryFilter() {
    currentCategory = elements.categoryFilter.value;
    currentPage = 1;
    loadPosts();
}

function handleSortFilter() {
    currentSort = elements.sortFilter.value;
    // Implement sorting logic here
    loadPosts();
}

// Search Functionality
function setupSearch() {
    elements.searchInput.addEventListener('focus', () => {
        if (currentSearchQuery) {
            showSearchResults();
        }
    });
}

async function handleSearch() {
    currentSearchQuery = elements.searchInput.value.trim();
    
    if (currentSearchQuery.length < 2) {
        if (elements.searchResultsSection.classList.contains('d-none')) {
            hideSearchResults();
        }
        return;
    }
    
    try {
        const data = await apiCall(`/search?q=${encodeURIComponent(currentSearchQuery)}`);
        
        if (data.success) {
            displaySearchResults(data);
            showSearchResults();
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

function displaySearchResults(data) {
    // Posts results
    if (data.posts && data.posts.length > 0) {
        elements.searchPostsResults.innerHTML = data.posts.map(post => `
            <div class="post-card">
                <div class="post-header">
                    <div class="post-avatar" style="background-color: ${post.avatar_color || '#007AFF'}">
                        ${post.username ? post.username.charAt(0).toUpperCase() : 'U'}
                    </div>
                    <div class="post-user">
                        <div class="post-username">${post.username}</div>
                        <div class="post-meta">${formatDate(post.timestamp)}</div>
                    </div>
                    <div class="post-category">${post.category}</div>
                </div>
                ${post.title ? `<div class="post-title">${post.title}</div>` : ''}
                <div class="post-content">${highlightSearchTerms(post.content, data.query)}</div>
            </div>
        `).join('');
    } else {
        elements.searchPostsResults.innerHTML = '<p class="text-muted">No posts found</p>';
    }
    
    // Users results
    if (data.users && data.users.length > 0) {
        elements.searchUsersResults.innerHTML = data.users.map(user => `
            <div class="topic-item">
                <div class="topic-avatar" style="background-color: ${user.avatar_color || '#007AFF'}">
                    ${user.username ? user.username.charAt(0).toUpperCase() : 'U'}
                </div>
                <div class="topic-content">
                    <div class="topic-title">${user.username}</div>
                    <div class="topic-meta">${user.bio || 'No bio'}</div>
                </div>
            </div>
        `).join('');
    } else {
        elements.searchUsersResults.innerHTML = '<p class="text-muted">No users found</p>';
    }
}

function highlightSearchTerms(text, query) {
    if (!text || !query) return text;
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
}

function showSearchResults() {
    hideAllSections();
    elements.searchResultsSection.classList.remove('d-none');
}

function hideSearchResults() {
    elements.searchResultsSection.classList.add('d-none');
    showMainContent();
}

function switchSearchTab(tabType) {
    document.querySelectorAll('.search-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    
    if (tabType === 'posts') {
        elements.searchPostsResults.classList.remove('d-none');
        elements.searchUsersResults.classList.add('d-none');
    } else {
        elements.searchPostsResults.classList.add('d-none');
        elements.searchUsersResults.classList.remove('d-none');
    }
}

// Analytics & Profile
async function showAnalytics() {
    try {
        const data = await apiCall('/analytics/overview');
        
        if (data.success) {
            analyticsData = data.overview;
            displayAnalytics();
            hideAllSections();
            elements.analyticsSection.classList.remove('d-none');
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

function displayAnalytics() {
    if (!analyticsData) return;
    
    elements.analyticsPosts.textContent = analyticsData.total_posts || 0;
    elements.analyticsUsers.textContent = analyticsData.total_users || 0;
    elements.analyticsLikes.textContent = '0'; // Would need additional endpoint
    elements.analyticsComments.textContent = '0'; // Would need additional endpoint
    
    // Category chart
    if (analyticsData.categories) {
        const maxCount = Math.max(...Object.values(analyticsData.categories));
        elements.categoryChartContainer.innerHTML = Object.entries(analyticsData.categories)
            .map(([category, count]) => `
                <div class="chart-bar">
                    <div class="chart-label">${category}</div>
                    <div class="chart-progress">
                        <div class="chart-fill" style="width: ${(count / maxCount) * 100}%"></div>
                    </div>
                    <div class="chart-count">${count}</div>
                </div>
            `).join('');
    }
    
    // Recent activity
    if (analyticsData.recent_activity) {
        elements.recentActivity.innerHTML = analyticsData.recent_activity
            .map(activity => `
                <div class="topic-item">
                    <div class="topic-avatar" style="background-color: #007AFF">
                        ${activity.username ? activity.username.charAt(0).toUpperCase() : 'U'}
                    </div>
                    <div class="topic-content">
                        <div class="topic-title">${activity.username} posted in ${activity.category}</div>
                        <div class="topic-meta">${formatDate(activity.timestamp)}</div>
                    </div>
                </div>
            `).join('');
    }
}

async function showProfile() {
    try {
        const data = await apiCall('/profile');
        
        if (data.success) {
            displayProfile(data);
            hideAllSections();
            elements.profileSection.classList.remove('d-none');
        }
    } catch (error) {
        // Error handled in apiCall
    }
}

function displayProfile(data) {
    const profile = data.profile;
    const stats = data.stats;
    
    elements.profileAvatar.textContent = profile.username.charAt(0).toUpperCase();
    elements.profileAvatar.style.backgroundColor = profile.avatar_color || '#007AFF';
    elements.profileName.textContent = profile.username;
    elements.profileBio.textContent = profile.bio || 'No bio yet';
    elements.profilePosts.textContent = stats.posts || 0;
    elements.profileLikes.textContent = stats.likes_received || 0;
    
    // Calculate membership duration
    if (profile.created_at) {
        const joinDate = new Date(profile.created_at);
        const today = new Date();
        const diffTime = Math.abs(today - joinDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        elements.profileMember.textContent = `${diffDays}d`;
    }
    
    // Load user's posts
    loadUserPosts();
}

async function loadUserPosts() {
    try {
        // This would need a dedicated endpoint for user posts
        // For now, we'll filter from all posts
        const userPosts = allPosts.filter(post => post.username === currentUser.username);
        displayUserPosts(userPosts);
    } catch (error) {
        console.error('Failed to load user posts:', error);
    }
}

function displayUserPosts(posts) {
    if (!posts || posts.length === 0) {
        elements.userPostsContainer.innerHTML = `
            <div class="post-card text-center py-5">
                <i class="bi bi-inbox display-1 text-muted mb-3"></i>
                <h3 class="text-muted">No posts yet</h3>
                <p class="text-muted">Start sharing your thoughts with the community!</p>
            </div>
        `;
        return;
    }
    
    elements.userPostsContainer.innerHTML = posts.map(post => `
        <div class="post-card">
            <div class="post-header">
                <div class="post-category">${post.category}</div>
                <div class="post-meta">${formatDate(post.timestamp)}</div>
            </div>
            ${post.title ? `<div class="post-title">${post.title}</div>` : ''}
            <div class="post-content">${post.content}</div>
            <div class="post-actions">
                <div class="post-action">
                    <i class="bi bi-heart"></i>
                    <span>${post.likes_count || 0}</span>
                </div>
                <div class="post-action">
                    <i class="bi bi-chat"></i>
                    <span>${post.comments_count || 0}</span>
                </div>
            </div>
        </div>
    `).join('');
}

// Pagination
function updatePagination(pagination) {
    if (!pagination || pagination.pages <= 1) {
        elements.paginationContainer.classList.add('d-none');
        return;
    }
    
    elements.paginationContainer.classList.remove('d-none');
    
    const prevPage = elements.paginationContainer.querySelector('#prev-page');
    const nextPage = elements.paginationContainer.querySelector('#next-page');
    
    prevPage.classList.toggle('disabled', currentPage === 1);
    nextPage.classList.toggle('disabled', currentPage === pagination.pages);
    
    prevPage.querySelector('a').onclick = (e) => {
        e.preventDefault();
        if (currentPage > 1) {
            currentPage--;
            loadPosts(currentPage);
        }
    };
    
    nextPage.querySelector('a').onclick = (e) => {
        e.preventDefault();
        if (currentPage < pagination.pages) {
            currentPage++;
            loadPosts(currentPage);
        }
    };
    
    // Update page numbers (simplified)
    const pageNumbers = elements.paginationContainer.querySelectorAll('.page-item:not(#prev-page):not(#next-page)');
    pageNumbers.forEach((item, index) => {
        if (index === 0) {
            item.querySelector('a').textContent = currentPage;
            item.classList.toggle('active', true);
        }
    });
}

// Stats & Updates
function updateStats(pagination) {
    if (pagination) {
        elements.statPosts.textContent = pagination.total || 0;
        // User count would need separate endpoint
    }
}

async function loadInitialData() {
    await Promise.all([
        loadPosts(),
        loadCategories(),
        loadTrendingTopics(),
        loadTopContributors()
    ]);
}

async function loadTrendingTopics() {
    // Simulated trending topics
    const trendingTopics = [
        { title: 'Welcome to Konekt!', category: 'General', replies: 24 },
        { title: 'Programming Tips', category: 'Engineering', replies: 18 },
        { title: 'Healthcare Discussion', category: 'Healthcare', replies: 12 }
    ];
    
    elements.trendingTopicsList.innerHTML = trendingTopics.map(topic => `
        <div class="topic-item">
            <div class="topic-avatar" style="background-color: #007AFF">
                ${topic.category.charAt(0)}
            </div>
            <div class="topic-content">
                <div class="topic-title">${topic.title}</div>
                <div class="topic-meta">${topic.category} â€¢ ${topic.replies} replies</div>
            </div>
        </div>
    `).join('');
}

async function loadTopContributors() {
    // Simulated top contributors
    const contributors = [
        { username: 'JohnDoe', posts: 42 },
        { username: 'SarahSmith', posts: 38 },
        { username: 'MikeJohnson', posts: 35 }
    ];
    
    elements.topContributors.innerHTML = contributors.map(contributor => `
        <div class="topic-item">
            <div class="topic-avatar" style="background-color: #34C759">
                ${contributor.username.charAt(0)}
            </div>
            <div class="topic-content">
                <div class="topic-title">${contributor.username}</div>
                <div class="topic-meta">${contributor.posts} posts</div>
            </div>
        </div>
    `).join('');
}

// Utility Functions
function hideAllSections() {
    elements.postsSection.classList.add('d-none');
    elements.analyticsSection.classList.add('d-none');
    elements.profileSection.classList.add('d-none');
    elements.searchResultsSection.classList.add('d-none');
}

function showMainContent() {
    hideAllSections();
    elements.postsSection.classList.remove('d-none');
}

function formatDate(dateString) {
    if (!dateString) return 'Recently';
    
    const date = new Date(dateString);
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    if (diffDays < 7) return `${diffDays}d ago`;
    
    return date.toLocaleDateString();
}

function showToast(message, type) {
    const toastId = type === 'success' ? 'successToast' : 'errorToast';
    const toastMessageId = type === 'success' ? 'successToastMessage' : 'errorToastMessage';
    
    const toastMessage = document.getElementById(toastMessageId);
    const toastElement = document.getElementById(toastId);
    
    if (toastMessage && toastElement) {
        toastMessage.textContent = message;
        const toast = new bootstrap.Toast(toastElement);
        toast.show();
    }
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function handleGlobalClick(event) {
    // Close search results when clicking outside
    if (!elements.searchContainer.contains(event.target) && 
        !elements.searchResultsSection.contains(event.target)) {
        hideSearchResults();
    }
}

// Health Check
async function performHealthCheck() {
    try {
        await apiCall('/health');
        console.log('API health check passed');
    } catch (error) {
        console.error('API health check failed:', error);
    }
}

// Periodic updates
setInterval(() => {
    if (currentUser) {
        loadPosts(currentPage);
    }
}, 30000); // Update every 30 seconds

// Initial health check
performHealthCheck();
      </script>
</body>
</html>