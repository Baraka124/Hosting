<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Konekt â€¢ Community Forum</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    :root {
      --apple-blue: #007AFF;
      --apple-gray-1: #F5F5F7;
      --apple-gray-2: #E8E8ED;
      --apple-gray-3: #C6C6C8;
      --apple-gray-6: #8E8E93;
      --apple-gray-9: #1D1D1F;
      --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--apple-gray-1);
      color: var(--apple-gray-9);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header Styles */
    .app-header {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 12px 0;
    }

    .app-header .navbar-brand {
      font-weight: 700;
      font-size: 24px;
      color: var(--apple-gray-9);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-header .navbar-brand i {
      color: var(--apple-blue);
    }

    .nav-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--apple-blue);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
    }

    /* Main Content */
    .main-content {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
      padding: 24px 0;
      min-height: calc(100vh - 80px);
    }

    /* Sidebar */
    .sidebar {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-section {
      margin-bottom: 32px;
    }

    .sidebar-section:last-child {
      margin-bottom: 0;
    }

    .sidebar-section h3 {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--apple-gray-9);
    }

    .category-list {
      list-style: none;
      padding: 0;
    }

    .category-list li {
      margin-bottom: 12px;
    }

    .category-list a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 10px;
      color: var(--apple-gray-9);
      text-decoration: none;
      transition: var(--transition);
    }

    .category-list a:hover, .category-list a.active {
      background: var(--apple-gray-2);
      color: var(--apple-blue);
    }

    .category-list i {
      font-size: 18px;
      width: 20px;
      text-align: center;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .stat-card {
      background: var(--apple-gray-1);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--apple-blue);
    }

    .stat-label {
      font-size: 13px;
      color: var(--apple-gray-6);
      margin-top: 4px;
    }

    /* Feed */
    .feed-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .welcome-card {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: var(--card-shadow);
      text-align: center;
    }

    .welcome-card h2 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .welcome-card p {
      color: var(--apple-gray-6);
      font-size: 17px;
      margin-bottom: 24px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .btn-apple {
      background: var(--apple-blue);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 600;
      font-size: 16px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-apple:hover {
      background: #0066D6;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 122, 255, 0.3);
    }

    .btn-apple-outline {
      background: transparent;
      color: var(--apple-blue);
      border: 2px solid var(--apple-blue);
      border-radius: 12px;
      padding: 10px 22px;
      font-weight: 600;
      font-size: 16px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-apple-outline:hover {
      background: rgba(0, 122, 255, 0.1);
      transform: translateY(-2px);
    }

    /* Posts */
    .posts-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .post-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
    }

    .post-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .post-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--apple-blue);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 18px;
    }

    .post-user {
      flex: 1;
    }

    .post-username {
      font-weight: 600;
      font-size: 17px;
      margin-bottom: 2px;
    }

    .post-meta {
      display: flex;
      gap: 12px;
      color: var(--apple-gray-6);
      font-size: 14px;
    }

    .post-category {
      background: var(--apple-gray-2);
      color: var(--apple-blue);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .post-content {
      font-size: 17px;
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .post-actions {
      display: flex;
      gap: 20px;
      border-top: 1px solid var(--apple-gray-2);
      padding-top: 16px;
    }

    .post-action {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--apple-gray-6);
      font-size: 14px;
      transition: var(--transition);
      cursor: pointer;
    }

    .post-action:hover {
      color: var(--apple-blue);
    }

    /* Modals */
    .modal-apple .modal-content {
      border-radius: 16px;
      border: none;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    }

    .modal-apple .modal-header {
      border-bottom: 1px solid var(--apple-gray-2);
      padding: 24px 24px 16px;
    }

    .modal-apple .modal-body {
      padding: 24px;
    }

    .modal-apple .modal-footer {
      border-top: 1px solid var(--apple-gray-2);
      padding: 16px 24px 24px;
    }

    .form-apple .form-control {
      border-radius: 12px;
      border: 2px solid var(--apple-gray-2);
      padding: 14px 16px;
      font-size: 16px;
      transition: var(--transition);
    }

    .form-apple .form-control:focus {
      border-color: var(--apple-blue);
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
    }

    .form-apple .form-label {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--apple-gray-9);
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 100px;
      right: 20px;
      z-index: 1100;
    }

    .toast-apple {
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      border: none;
      overflow: hidden;
    }

    .toast-apple .toast-header {
      border-bottom: none;
      padding: 12px 16px 0;
      background: transparent;
    }

    .toast-apple .toast-body {
      padding: 0 16px 12px;
    }

    /* Auth Section */
    #auth-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 992px) {
      .main-content {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        position: static;
      }
    }

    @media (max-width: 576px) {
      .app-container {
        padding: 0 16px;
      }
      
      .welcome-card {
        padding: 24px 16px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .post-card {
        padding: 20px 16px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <div class="app-container">
      <nav class="navbar navbar-expand-lg navbar-light p-0">
        <a class="navbar-brand" href="#">
          <i class="bi bi-chat-dots"></i>
          Konekt
        </a>
        
        <div class="ms-auto nav-user" id="user-section">
          <div class="d-none" id="logged-in-user">
            <span id="username-display"></span>
            <div class="user-avatar" id="user-avatar">U</div>
            <button class="btn btn-sm btn-outline-secondary" id="logout-btn">Log Out</button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="app-container">
    <div class="main-content">
      <!-- Sidebar (visible when logged in) -->
      <aside class="sidebar d-none" id="sidebar">
        <div class="sidebar-section">
          <h3>Categories</h3>
          <ul class="category-list">
            <li><a href="#" class="active"><i class="bi bi-house"></i> All Posts</a></li>
            <li><a href="#"><i class="bi bi-code-slash"></i> Engineering</a></li>
            <li><a href="#"><i class="bi bi-heart-pulse"></i> Healthcare</a></li>
            <li><a href="#"><i class="bi bi-lightbulb"></i> Research</a></li>
            <li><a href="#"><i class="bi bi-people"></i> Community</a></li>
          </ul>
        </div>
        
        <div class="sidebar-section">
          <h3>Forum Stats</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="stat-posts">0</div>
              <div class="stat-label">Posts</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-users">0</div>
              <div class="stat-label">Users</div>
            </div>
          </div>
        </div>
        
        <div class="sidebar-section">
          <h3>Online Now</h3>
          <div class="d-flex align-items-center gap-2">
            <div class="user-avatar" style="background-color: #34C759;">JD</div>
            <div class="user-avatar" style="background-color: #FF9500;">AS</div>
            <div class="user-avatar" style="background-color: #FF3B30;">MJ</div>
            <span class="text-muted">+12 more</span>
          </div>
        </div>
      </aside>

      <!-- Feed -->
      <section class="feed-container">
        <!-- Welcome Card (visible when not logged in) -->
        <section id="auth-section">
          <div class="welcome-card">
            <h2>Welcome to Konekt</h2>
            <p>Join our community to share ideas, ask questions, and connect with others.</p>
            <div class="action-buttons">
              <button class="btn-apple" data-bs-toggle="modal" data-bs-target="#loginModal">
                <i class="bi bi-box-arrow-in-right"></i> Sign In
              </button>
              <button class="btn-apple-outline" data-bs-toggle="modal" data-bs-target="#registerModal">
                <i class="bi bi-person-plus"></i> Create Account
              </button>
            </div>
          </div>
        </section>

        <!-- Create Post Card (visible when logged in) -->
        <section class="d-none" id="create-post-section">
          <div class="post-card">
            <div class="post-header">
              <div class="user-avatar" id="current-user-avatar">U</div>
              <div class="post-user">
                <div class="post-username" id="current-username">User</div>
                <div class="post-meta">Ready to share something?</div>
              </div>
            </div>
            <div class="post-content">
              <button class="btn-apple w-100" data-bs-toggle="modal" data-bs-target="#createPostModal">
                <i class="bi bi-plus-circle"></i> Create New Post
              </button>
            </div>
          </div>
        </section>

        <!-- Posts Container -->
        <section class="posts-container d-none" id="posts-section">
          <div id="posts-container">
            <!-- Posts will be dynamically inserted here -->
          </div>
        </section>
      </section>
    </div>
  </main>

  <!-- Login Modal -->
  <div class="modal fade modal-apple" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Sign In to Konekt</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form class="form-apple" id="loginForm">
            <div class="mb-3">
              <label for="loginUsername" class="form-label">Username</label>
              <input type="text" class="form-control" id="loginUsername" required>
            </div>
            <div class="mb-3">
              <label for="loginPassword" class="form-label">Password</label>
              <input type="password" class="form-control" id="loginPassword" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-apple-outline" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn-apple" id="loginBtn">Sign In</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Register Modal -->
  <div class="modal fade modal-apple" id="registerModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form class="form-apple" id="registerForm">
            <div class="mb-3">
              <label for="registerUsername" class="form-label">Username</label>
              <input type="text" class="form-control" id="registerUsername" required>
            </div>
            <div class="mb-3">
              <label for="registerPassword" class="form-label">Password</label>
              <input type="password" class="form-control" id="registerPassword" required>
            </div>
            <div class="mb-3">
              <label for="registerConfirmPassword" class="form-label">Confirm Password</label>
              <input type="password" class="form-control" id="registerConfirmPassword" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-apple-outline" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn-apple" id="registerBtn">Create Account</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Post Modal -->
  <div class="modal fade modal-apple" id="createPostModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Post</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form class="form-apple" id="createPostForm">
            <div class="mb-3">
              <label for="postCategory" class="form-label">Category</label>
              <select class="form-control" id="postCategory" required>
                <option value="">Select a category</option>
                <option value="General">General</option>
                <option value="Engineering">Engineering</option>
                <option value="Healthcare">Healthcare</option>
                <option value="Research">Research</option>
                <option value="Community">Community</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="postContent" class="form-label">Content</label>
              <textarea class="form-control" id="postContent" rows="5" required placeholder="What would you like to share?"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-apple-outline" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn-apple" id="createPostBtn">Publish Post</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container">
    <div class="toast toast-apple align-items-center text-white bg-success border-0 d-none" id="successToast">
      <div class="d-flex">
        <div class="toast-body" id="successToastMessage">Success!</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
    
    <div class="toast toast-apple align-items-center text-white bg-danger border-0 d-none" id="errorToast">
      <div class="d-flex">
        <div class="toast-body" id="errorToastMessage">Error!</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // API Configuration
    const API_BASE = "https://hosting-production-a352.up.railway.app/api";
    
    // DOM Elements
    const authSection = document.getElementById('auth-section');
    const createPostSection = document.getElementById('create-post-section');
    const postsSection = document.getElementById('posts-section');
    const sidebar = document.getElementById('sidebar');
    const loggedInUser = document.getElementById('logged-in-user');
    const postsContainer = document.getElementById('posts-container');
    const usernameDisplay = document.getElementById('username-display');
    const userAvatar = document.getElementById('user-avatar');
    const currentUsername = document.getElementById('current-username');
    const currentUserAvatar = document.getElementById('current-user-avatar');
    const statPosts = document.getElementById('stat-posts');
    const statUsers = document.getElementById('stat-users');
    
    // Modal Elements
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const createPostBtn = document.getElementById('createPostBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    
    // Toast Elements
    const successToast = document.getElementById('successToast');
    const errorToast = document.getElementById('errorToast');
    const successToastMessage = document.getElementById('successToastMessage');
    const errorToastMessage = document.getElementById('errorToastMessage');
    
    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      checkAuthStatus();
      setupEventListeners();
    });
    
    // Check if user is already logged in
    function checkAuthStatus() {
      const token = localStorage.getItem('token');
      const username = localStorage.getItem('username');
      
      if (token && username) {
        showAuthenticatedUI(username);
        loadPosts();
      } else {
        showUnauthenticatedUI();
      }
    }
    
    // Show UI for authenticated users
    function showAuthenticatedUI(username) {
      authSection.classList.add('d-none');
      createPostSection.classList.remove('d-none');
      postsSection.classList.remove('d-none');
      sidebar.classList.remove('d-none');
      loggedInUser.classList.remove('d-none');
      
      usernameDisplay.textContent = username;
      currentUsername.textContent = username;
      
      // Set avatar initials
      const initials = username.charAt(0).toUpperCase();
      userAvatar.textContent = initials;
      currentUserAvatar.textContent = initials;
    }
    
    // Show UI for unauthenticated users
    function showUnauthenticatedUI() {
      authSection.classList.remove('d-none');
      createPostSection.classList.add('d-none');
      postsSection.classList.add('d-none');
      sidebar.classList.add('d-none');
      loggedInUser.classList.add('d-none');
    }
    
    // Setup event listeners
    function setupEventListeners() {
      loginBtn.addEventListener('click', handleLogin);
      registerBtn.addEventListener('click', handleRegister);
      createPostBtn.addEventListener('click', handleCreatePost);
      logoutBtn.addEventListener('click', handleLogout);
    }
    
    // Handle user login
    async function handleLogin() {
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      if (!username || !password) {
        showToast('Please fill in all fields', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE}/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: username,
            password: password
          })
        });
        
        const data = await response.json();
        
        if (response.ok && data.token) {
          localStorage.setItem('token', data.token);
          localStorage.setItem('username', username);
          
          // Close modal and reset form
          const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
          loginModal.hide();
          document.getElementById('loginForm').reset();
          
          showAuthenticatedUI(username);
          loadPosts();
          showToast('Successfully signed in!', 'success');
        } else {
          showToast(data.error || 'Login failed', 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showToast('Network error. Please try again.', 'error');
      }
    }
    
    // Handle user registration
    async function handleRegister() {
      const username = document.getElementById('registerUsername').value;
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('registerConfirmPassword').value;
      
      if (!username || !password || !confirmPassword) {
        showToast('Please fill in all fields', 'error');
        return;
      }
      
      if (password !== confirmPassword) {
        showToast('Passwords do not match', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE}/register`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: username,
            password: password
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          // Close modal and reset form
          const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
          registerModal.hide();
          document.getElementById('registerForm').reset();
          
          showToast('Account created successfully! Please sign in.', 'success');
        } else {
          showToast(data.error || 'Registration failed', 'error');
        }
      } catch (error) {
        console.error('Registration error:', error);
        showToast('Network error. Please try again.', 'error');
      }
    }
    
    // Handle post creation
    async function handleCreatePost() {
      const category = document.getElementById('postCategory').value;
      const content = document.getElementById('postContent').value;
      const token = localStorage.getItem('token');
      
      if (!category || !content) {
        showToast('Please fill in all fields', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE}/posts`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': token
          },
          body: JSON.stringify({
            category: category,
            content: content
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          // Close modal and reset form
          const createPostModal = bootstrap.Modal.getInstance(document.getElementById('createPostModal'));
          createPostModal.hide();
          document.getElementById('createPostForm').reset();
          
          loadPosts();
          showToast('Post published successfully!', 'success');
        } else {
          showToast(data.error || 'Failed to create post', 'error');
        }
      } catch (error) {
        console.error('Create post error:', error);
        showToast('Network error. Please try again.', 'error');
      }
    }
    
    // Load posts from API
    async function loadPosts() {
      const token = localStorage.getItem('token');
      
      try {
        const response = await fetch(`${API_BASE}/posts`, {
          headers: {
            'Authorization': token
          }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          displayPosts(data.data || data);
          updateStats(data.data || data);
        } else {
          showToast(data.error || 'Failed to load posts', 'error');
        }
      } catch (error) {
        console.error('Load posts error:', error);
        showToast('Network error. Please try again.', 'error');
      }
    }
    
    // Display posts in the UI
    function displayPosts(posts) {
      if (!posts || posts.length === 0) {
        postsContainer.innerHTML = `
          <div class="post-card text-center py-5">
            <i class="bi bi-inbox display-1 text-muted mb-3"></i>
            <h3 class="text-muted">No posts yet</h3>
            <p class="text-muted">Be the first to share something with the community!</p>
          </div>
        `;
        return;
      }
      
      postsContainer.innerHTML = '';
      
      posts.forEach(post => {
        const postElement = document.createElement('div');
        postElement.className = 'post-card';
        postElement.innerHTML = `
          <div class="post-header">
            <div class="post-avatar">${post.username ? post.username.charAt(0).toUpperCase() : 'U'}</div>
            <div class="post-user">
              <div class="post-username">${post.username || 'Unknown User'}</div>
              <div class="post-meta">
                <span>${formatDate(post.timestamp)}</span>
              </div>
            </div>
            <div class="post-category">${post.category || 'General'}</div>
          </div>
          <div class="post-content">
            ${post.content || ''}
          </div>
          <div class="post-actions">
            <div class="post-action">
              <i class="bi bi-heart"></i>
              <span>24</span>
            </div>
            <div class="post-action">
              <i class="bi bi-chat"></i>
              <span>8</span>
            </div>
            <div class="post-action">
              <i class="bi bi-share"></i>
              <span>Share</span>
            </div>
          </div>
        `;
        
        postsContainer.appendChild(postElement);
      });
    }
    
    // Update forum statistics
    function updateStats(posts) {
      if (posts && posts.length > 0) {
        statPosts.textContent = posts.length;
        
        // Count unique users (simplified)
        const uniqueUsers = new Set(posts.map(post => post.username)).size;
        statUsers.textContent = uniqueUsers;
      } else {
        statPosts.textContent = '0';
        statUsers.textContent = '0';
      }
    }
    
    // Handle user logout
    function handleLogout() {
      localStorage.removeItem('token');
      localStorage.removeItem('username');
      showUnauthenticatedUI();
      showToast('Successfully signed out', 'success');
    }
    
    // Format date for display
    function formatDate(dateString) {
      if (!dateString) return 'Recently';
      
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return `${diffMins}m ago`;
      if (diffHours < 24) return `${diffHours}h ago`;
      if (diffDays < 7) return `${diffDays}d ago`;
      
      return date.toLocaleDateString();
    }
    
    // Show toast notification
    function showToast(message, type) {
      if (type === 'success') {
        successToastMessage.textContent = message;
        const toast = new bootstrap.Toast(successToast);
        toast.show();
      } else {
        errorToastMessage.textContent = message;
        const toast = new bootstrap.Toast(errorToast);
        toast.show();
      }
    }
  </script>
</body>
</html>